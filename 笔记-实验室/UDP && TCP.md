#### UDP 的特点

UDP无需建立连接。因此UDP不会引入建立连接的时延。

UDP不维护连接状态，也不跟踪这些参数，因此某些专用应用服务器使用UDP时，一般都能支持更多的活动客户机。

分组首部开销更小。TCP有20字节的的首部开销，而UDP只有8个字节的首部开销。

应用层能够更地控制要发送的数据和发送时间。UDP没有拥塞控制，因此网络中的拥塞也不会影响主机的发送效率。某些实时应用（**如直播**）要求以稳定的速度发送，能容忍一些数据的丢失，但不允许有较大的时延，而UDP正好可以满足这些应用的需求。

UDP常用于一次性传输比较小数据的网络应用，如DNS、SNMP等，因为对于这些应用，若采用TCP，则将为创建连接、维护和拆除而带来不小的开销。UDP也常用于多媒体应用（如IP电话、实时视频会议、流媒体等），显然，可靠数据传输对于这些应用来说并不是最重要的，但TCP的拥塞控制会导致数据出现较大的延迟，这是它们不可容忍的。

UDP提供尽最大努力的交付，即不保证可靠交付，但并不意味着应用对数据的要求是不可靠的，因此需要维护传输可靠性的工作需要用户在应用层来完成。应用实体可以根据应用需求来灵活设计自己的可靠性机制。

UDP是面向报文的的。发送方UDP对应用层交下来的报文，在添加首部后就交付给IP层，既不合并，也不拆分，而是保留这些报文的边界；接受方UDP对IP层交上来的用户数据报，在去除首部后就原封不动的交付给上层的应用进程，一次交付一个完整的报文，因此报文不可分割，是UDP数据处理的最小单位。

#### UDP的头部 

![è¿éåå¾çæè¿°](https://img-blog.csdn.net/20180517222301867?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0FTSkJGSlNC/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)



UDP需要注意的点：

TCP的报文头比UDP复杂许多，因为TCP除了实现端口可达外，它还提供了可靠的数据链路，包括流控、有序重组、多路复用等高级功能。由于上文提到的IP层报文拆分与重组是在IP层实现的，而IP层是不可靠的所有数组效率低下，所以TCP层还定义了MSS（Maximum Segment Size）最大报文长度，这个MSS肯定小于链路中所有网络的MTU，因此TCP优先在自己这一层拆成小报文避免的IP层的分包。而UDP协议报文头部太简单了，无法提供这样的功能，所以基于UDP协议开发的程序需要开发人员自行把握不要把过大的数据一次发送。











#### TCP相关

##### TCP是如何确定MSS 最大报文段的大小的？

跟最大报文段长度最为相关的一个参数是网络设备接口的MTU，以太网的MTU是1500，基本IP首部长度为20，TCP首部是20，所以MSS的值可达1460(MSS不包括协议首部，只包含应用数据)。

TCP 还有一个头部选项是可变的可选信息也就是头部的20-60字节当中的部分，如果没有这个信息tcp的头部就是20字节。TCP在初始化连接的时候也就是syn的时候通过这个选项来协商最大报文段的大小，对于以太网来说MSS为1460字节。

本地以太网中MSS为1460的说法并不正确，它还会动态变化，如果IP首部和TCP首部中出现选项，则MSS要相应的减小，一般TCP首部中会有12字节的时间戳选项(外加两字节的填充选项)，这时的MSS就等于1448

MSS的主要作用是限制另一端主机发送的数据的长度，同时，主机本身也控制自己发送数据报的长度，这将使以较小MTU连接到一个网络上的主机避免分段。

**但是这只能协商端到端两端的MSS 如果中间涉及多个中间设备和网络那么这个MSS是怎么取到最小的MSS的呢？**

![img](https://img-blog.csdn.net/20160403234524091)

就是说只有在三次握手阶段才能进行MSS的协调中间设备会修改这个可选字段的值 这样整体来回下来的MSS是最小值。因为三次握手当中是不会携带数据的所以本身是不可能被分片的。